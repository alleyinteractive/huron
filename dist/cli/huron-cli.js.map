{"version":3,"sources":["../../src/cli/huron-cli.js"],"names":["cwd","process","path","require","Gaze","Immutable","chalk","localConfig","join","config","huron","extensions","kssExtension","templates","extension","map","replace","dataStructure","Map","types","sections","sectionsByPath","sectionsByURI","sorted","prototypes","sectionTemplatePath","referenceDelimiter","store","gazeWatch","kssSource","kss","push","resolve","__dirname","sectionTemplate","forEach","sourceDir","gazeDir","slice","gaze","watched","production","on","filepath","console","log","green","blue","newPath","oldPath","red","close"],"mappings":"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","file":"huron-cli.js","sourcesContent":["\n\n// Local imports\nimport { initFiles, updateFile, deleteFile } from './actions';\nimport { requireTemplates, writeStore } from './require-templates';\nimport program from './parse-args';\nimport generateConfig from './generate-config';\nimport startWebpack from './server';\n\n// Modules\nconst cwd = process.cwd(); // Current working directory\nconst path = require('path');\nconst Gaze = require('gaze').Gaze;\nconst Immutable = require('immutable');\nconst chalk = require('chalk'); // Colorize terminal output\n\n// Set vars\nconst localConfig = require(path.join(cwd, program.config)); // eslint-disable-line import/no-dynamic-require\nconst config = generateConfig(localConfig);\n\n/**\n * Huron configuration object\n *\n * @global\n */\nconst huron = config.huron;\n\n/**\n * Available file extensions. Extensions should not include the leading '.'\n *\n * @global\n */\nconst extensions = [\n  huron.kssExtension,\n  huron.templates.extension,\n  'html',\n  'json',\n].map((extension) => extension.replace('.', ''));\n\n// Create initial data structure\n/* eslint-disable */\n/**\n * Initial structure for immutable data store\n *\n * @global\n */\nconst dataStructure = Immutable.Map({\n  types: [\n    'template',\n    'data',\n    'description',\n    'section',\n    'prototype',\n    'sections-template',\n  ],\n  config: Immutable.Map(config.huron),\n  sections: Immutable.Map({\n    sectionsByPath: Immutable.Map({}),\n    sectionsByURI: Immutable.Map({}),\n    sorted: {},\n  }),\n  templates: Immutable.Map({}),\n  prototypes: Immutable.Map({}),\n  sectionTemplatePath: '',\n  referenceDelimiter: '.',\n});\n/* eslint-enable */\n\n/**\n * Data store, to be initialized with dataStructure\n *\n * @global\n */\nlet store = null; // All updates to store will be here\n\n// Generate watch list for Gaze, start gaze\nconst gazeWatch = [];\nconst kssSource = [...huron.kss];\n\ngazeWatch.push(path.resolve(__dirname, huron.sectionTemplate));\nkssSource.forEach((sourceDir) => {\n  let gazeDir = sourceDir;\n\n  /* eslint-disable space-unary-ops */\n  if ('/' === sourceDir.slice(-1)) {\n    gazeDir = sourceDir.slice(0, -1);\n  }\n  /* eslint-enable space-unary-ops */\n\n  gazeWatch.push(\n    `${gazeDir}/**/*.+(${extensions.join('|')})`\n  );\n});\n\n/**\n * Gaze instance for watching all files, including KSS, html, hbs/template, and JSON\n *\n * @global\n */\nconst gaze = new Gaze(gazeWatch);\n\n// Initialize all files watched by gaze\nstore = initFiles(gaze.watched(), dataStructure);\nrequireTemplates(store);\nwriteStore(store);\n\nif (! program.production) {\n  /** @module cli/gaze */\n\n  /**\n   * Anonymous handler for Gaze 'changed' event indicating a file has changed\n   *\n   * @callback changed\n   * @listens gaze:changed\n   * @param {string} filepath - absolute path of changed file\n   */\n  gaze.on('changed', (filepath) => {\n    store = updateFile(filepath, store);\n    console.log(chalk.green(`${filepath} updated!`));\n  });\n\n  /**\n   * Anonymous handler for Gaze 'added' event indicating a file has been added to the watched directories\n   *\n   * @callback added\n   * @listens gaze:added\n   * @param {string} filepath - absolute path of changed file\n   */\n  gaze.on('added', (filepath) => {\n    store = updateFile(filepath, store);\n    writeStore(store);\n    console.log(chalk.blue(`${filepath} added!`));\n  });\n\n  /**\n   * Anonymous handler for Gaze 'renamed' event indicating a file has been renamed\n   *\n   * @callback renamed\n   * @listens gaze:renamed\n   * @param {string} filepath - absolute path of changed file\n   */\n  gaze.on('renamed', (newPath, oldPath) => {\n    store = deleteFile(oldPath, store);\n    store = updateFile(newPath, store);\n    writeStore(store);\n    console.log(chalk.blue(`${newPath} added!`));\n  });\n\n  /**\n   * Anonymous handler for Gaze 'deleted' event indicating a file has been removed\n   *\n   * @callback deleted\n   * @listens gaze:deleted\n   * @param {string} filepath - absolute path of changed file\n   */\n  gaze.on('deleted', (filepath) => {\n    store = deleteFile(filepath, store);\n    writeStore(store);\n    console.log(chalk.red(`${filepath} deleted`));\n  });\n} else {\n  gaze.close();\n}\n\n// Start webpack or build for production\nstartWebpack(config);\n"]}